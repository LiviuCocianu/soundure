import React, { useMemo } from 'react'
import { useSelector } from 'react-redux'

import HorizontalCategory from '../../../general/HorizontalCategory'
import { find, reverse } from '../../../../functions';

/**
 * HistoryCategory component
 * 
 * @param {object} props props object
 * @param {object} props.navigation Object generated by React Navigation
 * @param {number} props.maxContent Maximum amount of content to display in the category
 * 
 * @returns {JSX.Element} JSX component
 */
const HistoryCategory = ({
    navigation,
    maxContent = 10
}) => {
    /** 
     * We use the playlists content state here to update the component every time the user
     * listens to a track and it gets added to the history playlist
     * */
    const playlistsContent = useSelector(state => state.playlistsContent);
    const playlists = useSelector(state => state.playlists);
    const tracks = useSelector(state => state.tracks);

    const historyTracks = useMemo(() => {
        const histPlaylist = playlists.find(pl => pl.title == "_HISTORY");

        if(histPlaylist) {
            const historyTrackIds = reverse(playlistsContent
                .filter(rel => rel.playlistId === histPlaylist.id)
                .map(rel => rel.trackId));

            return historyTrackIds.map(id => find(tracks, "id", id, undefined)).filter(tr => tr != undefined);
        }

        return [];
    }, [playlistsContent, playlists, tracks]);

    return (
        <HorizontalCategory 
            navigation={navigation}
            title="Istoricul redÄƒrilor" 
            tracks={historyTracks}
            maxContent={maxContent}/>
    );
};

export default HistoryCategory
